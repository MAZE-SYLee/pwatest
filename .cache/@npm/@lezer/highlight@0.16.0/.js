import{NodeProp as t}from"/@npm/@lezer/common";let e=0;class a{constructor(t,a,i){this.set=t,this.base=a,this.modified=i,this.id=e++}static define(t){if(null==t?void 0:t.base)throw new Error("Can not derive from a modified tag");let e=new a([],null,[]);if(e.set.push(e),t)for(let a of t.set)e.set.push(a);return e}static defineModifier(){let t=new r;return e=>e.modified.indexOf(t)>-1?e:r.get(e.base||e,e.modified.concat(t).sort((t,e)=>t.id-e.id))}}let i=0;class r{constructor(){this.instances=[],this.id=i++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find(a=>{return a.base==t&&(i=e,r=a.modified,i.length==r.length&&i.every((t,e)=>t==r[e]));var i,r});if(i)return i;let s=[],o=new a(s,t,e);for(let a of e)a.instances.push(o);let l=function permute(t){let e=[t];for(let a=0;a<t.length;a++)for(let i of permute(t.slice(0,a).concat(t.slice(a+1))))e.push(i);return e}(e);for(let a of t.set)for(let t of l)s.push(r.get(a,t));return o}}function styleTags(t){let e=Object.create(null);for(let a in t){let i=t[a];Array.isArray(i)||(i=[i]);for(let t of a.split(" "))if(t){let a=[],r=2,s=t;for(let e=0;;){if("..."==s&&e>0&&e+3==t.length){r=1;break}let i=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(s);if(!i)throw new RangeError("Invalid path: "+t);if(a.push("*"==i[0]?"":'"'==i[0][0]?JSON.parse(i[0]):i[0]),e+=i[0].length,e==t.length)break;let o=t[e++];if(e==t.length&&"!"==o){r=0;break}if("/"!=o)throw new RangeError("Invalid path: "+t);s=t.slice(e)}let l=a.length-1,n=a[l];if(!n)throw new RangeError("Invalid path: "+t);let h=new o(i,r,l>0?a.slice(0,l):null);e[n]=h.sort(e[n])}}return s.add(e)}const s=new t;class o{constructor(t,e,a,i){this.tags=t,this.mode=e,this.context=a,this.next=i}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}function tagHighlighter(t,e){let a=Object.create(null);for(let s of t)if(Array.isArray(s.tag))for(let t of s.tag)a[t.id]=s.class;else a[s.tag.id]=s.class;let{scope:i,all:r=null}=e||{};return{style:t=>{let e=r;for(let i of t)for(let t of i.set){let i=a[t.id];if(i){e=e?e+" "+i:i;break}}return e},scope:i}}function highlightTags(t,e){let a=null;for(let i of t){let t=i.style(e);t&&(a=a?a+" "+t:t)}return a}function highlightTree(t,e,a,i=0,r=t.length){let s=new l(i,Array.isArray(e)?e:[e],a);s.highlightRange(t.cursor(),i,r,"",s.highlighters),s.flush(r)}class l{constructor(t,e,a){this.at=t,this.highlighters=e,this.span=a,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(e,a,i,r,o){let{type:l,from:n,to:h}=e;if(n>=i||h<=a)return;l.isTop&&(o=this.highlighters.filter(t=>!t.scope||t.scope(l)));let c=r,g=l.prop(s),f=!1;for(;g;){if(!g.context||e.matchContext(g.context)){let t=highlightTags(o,g.tags);t&&(c&&(c+=" "),c+=t,1==g.mode?r+=(r?" ":"")+t:0==g.mode&&(f=!0));break}g=g.next}if(this.startSpan(e.from,c),f)return;let d=e.tree&&e.tree.prop(t.mounted);if(d&&d.overlay){let t=e.node.enter(d.overlay[0].from+n,1),s=this.highlighters.filter(t=>!t.scope||t.scope(d.tree.type)),l=e.firstChild();for(let g=0,f=n;;g++){let m=g<d.overlay.length?d.overlay[g]:null,p=m?m.from+n:h,u=Math.max(a,f),k=Math.min(i,p);if(u<k&&l)for(;e.from<k&&(this.highlightRange(e,u,k,r,o),this.startSpan(Math.min(i,e.to),c),!(e.to>=p)&&e.nextSibling()););if(!m||p>i)break;f=m.to+n,f>a&&(this.highlightRange(t.cursor(),Math.max(a,m.from+n),Math.min(i,f),r,s),this.startSpan(f,c))}l&&e.parent()}else if(e.firstChild()){do{if(!(e.to<=a)){if(e.from>=i)break;this.highlightRange(e,a,i,r,o),this.startSpan(Math.min(i,e.to),c)}}while(e.nextSibling());e.parent()}}}const n=a.define,h=n(),c=n(),g=n(c),f=n(c),d=n(),m=n(d),p=n(d),u=n(),k=n(u),b=n(),y=n(),N=n(),v=n(N),w=n(),x={comment:h,lineComment:n(h),blockComment:n(h),docComment:n(h),name:c,variableName:n(c),typeName:g,tagName:n(g),propertyName:f,attributeName:n(f),className:n(c),labelName:n(c),namespace:n(c),macroName:n(c),literal:d,string:m,docString:n(m),character:n(m),attributeValue:n(m),number:p,integer:n(p),float:n(p),bool:n(d),regexp:n(d),escape:n(d),color:n(d),url:n(d),keyword:b,self:n(b),null:n(b),atom:n(b),unit:n(b),modifier:n(b),operatorKeyword:n(b),controlKeyword:n(b),definitionKeyword:n(b),moduleKeyword:n(b),operator:y,derefOperator:n(y),arithmeticOperator:n(y),logicOperator:n(y),bitwiseOperator:n(y),compareOperator:n(y),updateOperator:n(y),definitionOperator:n(y),typeOperator:n(y),controlOperator:n(y),punctuation:N,separator:n(N),bracket:v,angleBracket:n(v),squareBracket:n(v),paren:n(v),brace:n(v),content:u,heading:k,heading1:n(k),heading2:n(k),heading3:n(k),heading4:n(k),heading5:n(k),heading6:n(k),contentSeparator:n(u),list:n(u),quote:n(u),emphasis:n(u),strong:n(u),link:n(u),monospace:n(u),strikethrough:n(u),inserted:n(),deleted:n(),changed:n(),invalid:n(),meta:w,documentMeta:n(w),annotation:n(w),processingInstruction:n(w),definition:a.defineModifier(),constant:a.defineModifier(),function:a.defineModifier(),standard:a.defineModifier(),local:a.defineModifier(),special:a.defineModifier()},M=tagHighlighter([{tag:x.link,class:"tok-link"},{tag:x.heading,class:"tok-heading"},{tag:x.emphasis,class:"tok-emphasis"},{tag:x.strong,class:"tok-strong"},{tag:x.keyword,class:"tok-keyword"},{tag:x.atom,class:"tok-atom"},{tag:x.bool,class:"tok-bool"},{tag:x.url,class:"tok-url"},{tag:x.labelName,class:"tok-labelName"},{tag:x.inserted,class:"tok-inserted"},{tag:x.deleted,class:"tok-deleted"},{tag:x.literal,class:"tok-literal"},{tag:x.string,class:"tok-string"},{tag:x.number,class:"tok-number"},{tag:[x.regexp,x.escape,x.special(x.string)],class:"tok-string2"},{tag:x.variableName,class:"tok-variableName"},{tag:x.local(x.variableName),class:"tok-variableName tok-local"},{tag:x.definition(x.variableName),class:"tok-variableName tok-definition"},{tag:x.special(x.variableName),class:"tok-variableName2"},{tag:x.definition(x.propertyName),class:"tok-propertyName tok-definition"},{tag:x.typeName,class:"tok-typeName"},{tag:x.namespace,class:"tok-namespace"},{tag:x.className,class:"tok-className"},{tag:x.macroName,class:"tok-macroName"},{tag:x.propertyName,class:"tok-propertyName"},{tag:x.operator,class:"tok-operator"},{tag:x.comment,class:"tok-comment"},{tag:x.meta,class:"tok-meta"},{tag:x.invalid,class:"tok-invalid"},{tag:x.punctuation,class:"tok-punctuation"}]);export{a as Tag,M as classHighlighter,highlightTags,highlightTree,styleTags,tagHighlighter,x as tags};